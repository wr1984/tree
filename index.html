<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>Tree</title>
		<style type="text/css">
			html,
			body {
				margin: 0;
				padding: 0;
				line-height: 0;
				font-size: 0;
				width: 100%;
				height: 100%;
			}
			
			#tree-sucai {
				position: absolute;
				top: 0;
				left: 0;
			}
			
			.tree-bg {
				/*width: 1200px;*/
				/*display: block;*/
				margin: 0 auto;
				overflow: hidden;
				background-image: url(img/tree.png);
				background-position:left top;
				background-repeat: no-repeat;
				background-size:100% 100%;				 
			}
			.tree-logo-box{
				position: relative;
				top: 50%;
				margin-left: 50%;
			}
			.tree-logo{
				width: 400px;
				margin-left: -200px;
				margin-top: -200px;
				
			}
			#yz0{
				position: relative;
				width: 100px;
				height: 100px;
				left: 160px;
				top: 300px;
			}
		</style>
	</head>

	<body>
		<!--<img src="img/Tree.png" />-->
		<!--<svg width="100%" height="100%" viewBox="0 0 1000 800" version="1.1" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin meet">-->
		<div class="tree-bg" style="width: 1280px; height: 800px;">
			<div class="tree-logo-box"><img class="tree-logo" src="img/tree-logo.png" /></div>
			<!--<img id="yz0" src="img/yz0.png"/>-->
		</div>
<!--		<embed id="tree-bg" src="img/tree-bg-d.svg" width="100%" height="100%"></embed>
-->	</body>
	<script src="lib/TweenMax.min.js" type="text/javascript" charset="utf-8"></script>
	<script>
		window.onload = function() {
//			var me = this;
			var SVG_NS = "http://www.w3.org/2000/svg";
			var XLINK_NS = "http://www.w3.org/1999/xlink";
			var width = 1280;
			var height =800;
			var treebg = document.querySelector('.tree-bg');
			var scale = 1;
//			treebg.style.width = width + 'px';
//			treebg.style.height = height + 'px';
//			treebg.setAttribute('background-image','url(img/tree.png)');
//			treebg.setAttribute('background-position','left top');
//			treebg.setAttribute('background-repeat','no-repeat');
			
			var windowScale = width/height;
//			var svg = document.querySelector('svg');
			
//			var embed = document.querySelector('#tree-bg');
//			
//			var svg_bg = embed.getSVGDocument().querySelector('#svg');
//			var svg_width = svg_bg.getAttribute('viewBox').split(" ")[2];
//			var svg_height = svg_bg.getAttribute('viewBox').split(" ")[3];
			var scaleX = 1;
			var scaleY = 1;
			
			
			
//			var yz6 = svg_bg.getElementById('yz6');
//			var yz7 = svg_bg.getElementById('yz7');
//			var yz8 = svg_bg.getElementById('yz8');
//			var yz9 = svg_bg.getElementById('yz9');
//			var yz10 = svg_bg.getElementById('yz10');
//			var sg5 = svg_bg.getElementById('sg5');
//			
//			Tween.to(yz6,2,{
//				scale:1,
//				transformOrigin:"0% 100%"
//			})
			
			
//			var sg2 = svg_bg.getElementById('sg2');
//			var sg3 = svg_bg.getElementById('sg3');
//			var sg4 = svg_bg.getElementById('sg4');
//			var bg = svg_bg.getElementById('bg');
			
			
			
//			var yzOrigin = ["0% 80%","90% 90%","10% 90%","10% 90%","90% 10%","0% 100%","0% 100%","100% 100%","100% 100%","100% 100%"];
//			var sgOrigin = ["0% 100%","10% 100%","0% 100%","0% 100%","0% 100%"];
			
			var yzOrigin = ["0% 100%","0% 100%%","10% 90%","10% 90%","0% 100%","0% 100%","40% 100%","40% 100%","100% 100%","100% 100%","0% 100%","0% 100%","0% 100%","0% 100%"];
			var sgOrigin = ["50% 100%","50% 100%","0% 100%","0% 100%","90% 100%","90% 100%","90% 100%","90% 100%"];
			var posArr = [[100,200],[100,300]]
			var yzArr = initSucai('yz',2,yzOrigin);
			
//			var yzArr = initSucai('sy', 14, yzOrigin);
//			var sgArr = initSucai('sg', 8, sgOrigin);
//			var sucaiArr = yzArr.concat(sgArr);
			
			yzArr.forEach(function(yz){
				yz.init();
				yz.grow(randomInRange(5,20),randomInRange(1,5));
			});
//			sgArr.forEach(function(sg){
//				sg.init();
//				sg.grow(randomInRange(5,10),randomInRange(1,5));
//			});
			
			function initSucai(name,count,origin){
				var arr = [];
				for(var i = 0; i<count; i++){
//					var img = new Image().src = "img/yz"+i+".png";
					var img = document.createElement('img');
					img.setAttribute('src',"img/yz"+i+".png");
					console.log(img)
					img.style.marginLeft = posArr[i][0]+'px';
					img.style.marginTop = posArr[i][1]+'px';
					treebg.appendChild(img);
					arr.push(new SucaiObj(name,i,img,origin,posArr[i][0],posArr[i][1]));
				}
				return arr;
			}
			
			function SucaiObj(name,index,el,origin,x,y){
				
				this.id = name+index;
				this.name = name;
				this.el = el;
				this.x = x;
				this.y = y;
				this.opacity = 0.8;
				this.scale = 0;
				this.transformOrigin = origin[index];
				this.isFall = false;
			
				SucaiObj.prototype.init = function(){
					TweenMax.set(this.el,{
						opacity: this.opacity,
						scale: this.scale,
						transformOrigin: this.transformOrigin
					});
//					this.x = this.el.getAttribute('data-svg-origin').split(" ")[0];
//					this.y = this.el.getAttribute('data-svg-origin').split(" ")[1];
				}
				SucaiObj.prototype.grow = function(growTime,delayTime,scale,startAt){
						TweenMax.killTweensOf(this.el);
						TweenMax.to(this.el,growTime || 10,{
							scale: scale || 1,
							ease:Linear.easeNone,
							delay:delayTime || 2,
//							startAt:startAt
						});
						
//						console.log(yz1)
				}
				SucaiObj.prototype.shake = function(s,t){
					if(!this.isFall){
					  TweenMax.killTweensOf(this.el);
//					  TweenMax.to(this.el,3,{
//					  	rotation:30,
//					  	repeat:1,
//					  	yoyo:true,
//					  	ease: Elastic.easeOut.config(1, 0.1)
//					  })
					  new TimelineMax().to(this.el, .2+t||0, {rotation:10+s||0, })
								       .to(this.el, .3+t||0, {rotation:-10-s||0, ease:Linear.easeInOut})
								       .to(this.el, .4+t||0, {rotation:8+s||0, ease:Linear.easeInOut})
								       .to(this.el, .5+t||0, {rotation:-8-s||0, ease:Linear.easeInOut})
								       .to(this.el, .6+t||0, {rotation:6+s||0, ease:Linear.easeInOut})
								       .to(this.el, .7+t||0, {rotation:-6-s||0, ease:Linear.easeInOut})
								       .to(this.el, .8+t||0, {rotation:2, ease:Linear.easeInOut})
								       .to(this.el, .9+t||0, {rotation:-2, ease:Linear.easeInOut})
								       .to(this.el, .9+t||0, {rotation:1, ease:Linear.easeInOut})
								       .to(this.el, 1+t||0, {rotation:0, ease:Linear.easeInOut})						       
					}
				}
				SucaiObj.prototype.fall = function(t){
					
					var t = new TimelineMax({delay:t||0});
					t.to(this.el,20,{y:800,
//						ease:RoughEase.ease.config({ template:  Power0.easeNone, strength: 1, points: 5, taper: "none", randomize: true, clamp: false}),
//						ease:Power0.easeOut,
//						onStart:function(){
//							TweenMax.killTweensOf(this.el,true,{rotation:true});
//						}
//						overwrite:3
					})
//					.to(this.el,2,{rotation:130, repeat:3,yoyo:true},'-=19')
			       .to(this.el, randomInRange(5,10), {x:"+="+ randomInRange(300,600),ease:Power0.easeOut},'-=20')
//			       .to(this.el, 1, {rotation:"+=10",repeat:5,yoyo:true,ease:Power0.easeOut},'-=20')
//			       .to(this.el, 2, {x:"-=50"},'-=18')
//			       .to(this.el, 2, {x:"+=50"},'-=13')

			       
				
	
//					.to(this.el,15,{
//						rotation:360*randomInRange(1,3),
//					},"-=18")
					.set(this.el,{
						x:0,
						y:0,
						rotation:0,
						scale:0
					})
					.to(this.el,1,{

						onComplete:this.reGrow,
						onCompleteParams:[this]
					})
				}
				
				SucaiObj.prototype.reGrow = function(obj){
					obj.isFall = false
					obj.grow(randomInRange(5,20),randomInRange(1,5),1);
				}
			}
			
			
			function sucaiShake(e){
				var x = e.clientX;
				var y = e.clientY;
				console.log(x,y)
				yzArr.forEach(function(sucai){
//					console.log(sucai.x,sucai.y)
//					console.log(Math.abs(x-sucai.x)+"__"+Math.abs(y-sucai.y))
					if(Math.abs(x-sucai.x)<20 && Math.abs(y-sucai.y)<20){
						sucai.shake(5,0);
						if(Math.random()>0.9){
							sucai.isFall = true;
							sucai.fall(0.5);
						}
					}
					
				});
				
			}
//			window.addEventListener('resize',resize,false);
			function resize (){
				width = window.innerWidth;
				height = window.innerHeight;
//				treebg.style.width = width + 'px';
//				treebg.style.height = height + 'px';
				var scaleX = width/1280;
				var scaleY = height/800;
				
				yzArr.forEach(function(yz){
					yz.el.style.marginLeft = yz.x*scaleX+'px';
					yz.el.style.marginTop = yz.y*scaleY+'px';
					TweenMax.set(yz.el,{
						scaleX:scaleX,
						scaleY:scaleY
					})
				})
			}
			treebg.addEventListener('mousemove',sucaiShake,false);
			treebg.addEventListener('mousedown',function(e){
				e.preventDefault();
			},false);
//			
			function randomInRange(min,max){
				return Math.round(Math.random()*(max-min+1))+min;
			}
			
//			function use(origin){
//				var useTag = document.createElementNS(SVG_NS,'use');
//				useTag.setAttributeNS(XLINK_NS,'xlink:href','#'+origin.id);
//				return useTag;
//			}
//			
//			function randerShape(shape,x,y,rotate){
//				var useShape = use(shape);
//				useShape.setAttribute('x',x);
//				useShape.setAttribute('y',y);
////				useShape.setAttribute('transform','translate(' + x +','+y +')');
//				tree_bg.appendChild(useShape);
//				return useShape;
//			}

			setInterval(function(){
				yzArr.forEach(function(sucai){
					if(Math.random()>0.5 && !TweenMax.isTweening(sucai)){
						sucai.shake(-5,0.5);
						if(Math.random()>0.15){
							sucai.isFall = true;
							sucai.fall(2);
						}
					}
				});
			},20000)
		};
	</script>

</html>