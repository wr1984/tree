<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>Tree</title>
		<style type="text/css">
			html,
			body {
				margin: 0;
				padding: 0;
				line-height: 0;
				font-size: 0;
			}
			
			#tree-sucai {
				position: absolute;
				top: 0;
				left: 0;
			}
			#svg{
				position: absolute;
				/*height: 100%;*/
				/*width: 1000px;
				height: 500px;*/
				/*background-image: url(img/tree-bg.png);*/
				/*background-size:auto 100%;
				background-repeat:no-repeat;*/
			}
			#box>.logo{
				position: absolute;
				width: 100%;
				height: 100%;
				z-index: 999;
				background-image: url(img/tree-logo.png);
				background-position: center;	
				background-size: 30% 40%;
				background-repeat: no-repeat;
			}
			#box{
				position: relative;
				overflow: hidden;
			}
			#bg{
				position: absolute;
				height: 100%;
				background-image: url(img/tree-3200x786.png);
				background-position: center;	
				background-size: 100% 100%;
				background-repeat: no-repeat;
			}
		</style>
	</head>

	<body>
		<!--<img src="img/Tree.png" />-->
		<!--<svg width="100%" height="100%" viewBox="0 0 1000 800" version="1.1" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin meet">-->
		<div id="box">
			<div id="bg"></div>
			<div id="svg" >
					<embed id="tree-bg" src="img/tree-yz-3200x786.svg" width="100%" height="100%"></embed>
					<!--<embed id="tree-bg2" src="img/tree-bg-d.svg" width="50%" height="100%"></embed>-->
			</div>
			<div class="logo"></div>
		</div>
	</body>
	<script src="lib/TweenMax.min.js" type="text/javascript" charset="utf-8"></script>
	<script>
		window.onload = function() {
//			var me = this;
			var SVG_NS = "http://www.w3.org/2000/svg";
			var XLINK_NS = "http://www.w3.org/1999/xlink";
			var width = window.innerWidth;
			var height = window.innerHeight;
			var windowScale = width/height;
			var svgBox = document.querySelector('#box');
//			svgBox.style.overflow = 'hidden';
			svgBox.style.width = width + 'px';
			svgBox.style.height = height + 'px';
//			svgBox.style.width = '1600px';
//			svgBox.style.height = '700px';

			
			
			var embed = document.querySelector('#tree-bg');
//			var embed2 = document.querySelector('#tree-bg2');
			
			var svg_bg = embed.getSVGDocument().querySelector('#svg');
//			var svg_bg2 = embed2.getSVGDocument().querySelector('#svg');
			var svg_width = svg_bg.getAttribute('viewBox').split(" ")[2];
			var svg_height = svg_bg.getAttribute('viewBox').split(" ")[3];
			var scaleX = svg_width/width;
			var scaleY = svg_height/height;
			
			//跑马灯
//			svgBox.innerHTML += svgBox.innerHTML;
			let bg = document.getElementById('bg');
			let yzsvg = document.getElementById('svg');
			bg.style.width = width*2 + 'px';
			yzsvg.style.width  = width*2 + 'px';
			
			
			var yzOrigin = ["10% 100%","100% 90%","100% 100%","100% 90%","0% 100%","100% 100%","100% 90%","0% 100%","100% 100%"];
			var hdOringin = ["50% 50%","50% 50%"];

			var hdArr1 = initSucai('hd1_','hd2_',1,hdOringin,svg_bg);
//			var hdArr2 = initSucai('hd2_',1,hdOringin,svg_bg);
			var sucai1Arr = initSucai('yz1_','yz2_',9, yzOrigin,svg_bg);
//			var sucai2Arr = initSucai('yz2_', 9, yzOrigin,svg_bg);
			
			var left = null;
			setInterval(function(){
				left -= 0.1;
				if(left < -bg.offsetWidth/2){
					left=0;
				}
				yzsvg.style.left = left + 'px';
				bg.style.left = left + 'px';
			},60/1000);
//			console.log(sucai1Arr[0].el);
//			console.log(sucai1Arr[0].el2);
			
			
			sucai1Arr.forEach(function(yz){
				yz.init();
				yz.grow(randomInRange(5,20),randomInRange(1,5));
			});
			hdArr1.forEach(function(hd){
				hd.init();
				hd.grow(0.1,0.1);
			})
			
			function initSucai(name1,name2,count,origin,svg){
				var arr = [];
				for(var i = 0; i<count; i++){
					arr.push(new SucaiObj(name1,name2,i,origin,svg));
				}
				return arr;
			}
			
			function SucaiObj(name1,name2,index,origin,svg){
				
//				this.id = name+index;
//				this.name = name;
				this.el = svg.getElementById(name1+ index); 
				this.el2 = svg.getElementById(name2+ index);
				this.x;
				this.y;
				this.opacity = 0.9;
				this.scale = 0;
				this.transformOrigin = origin[index];
				this.isFall = false;
				this.isGrow = false;
				this.isShake = false;
			
				SucaiObj.prototype.init = function(){
					TweenMax.set([this.el,this.el2],{
						opacity: this.opacity,
						scale: this.scale,
						transformOrigin: this.transformOrigin
					});
//					this.x = this.el.getAttribute('data-svg-origin').split(" ")[0];
//					this.y = this.el.getAttribute('data-svg-origin').split(" ")[1];
				}
				SucaiObj.prototype.grow = function(growTime,delayTime,scale,startAt){
					this.isGrow = true;
					TweenMax.to([this.el,this.el2],growTime || 10,{
						scale: scale || 1,
						ease:Linear.easeNone,
						delay:delayTime || 2,
						startAt:startAt,
						onComplete:function(me){me.isGrow = false},
						onCompleteParams:[this]
					});
						
//						console.log(yz1)
				}
				SucaiObj.prototype.shake = function(){
					if(!this.isFall && !this.isGrow && !this.isShake){
//					  TweenMax.killTweensOf(this.el);
						this.isShake = true;
					  new TimelineMax().to([this.el,this.el2],0.2,{
					  	rotation:10
					  })
					  .to([this.el,this.el2], 10, {
					  	rotation:0,
					  	ease:Elastic.easeOut.config(3, 0.1),
					  	onComplete:function(me){
					  		me.isShake = false;
					  		if(Math.random() > 0.8){
					  			me.fall(); 
					  		}
					  	},
						onCompleteParams:[this]
					  
					  })
//					  .to(this.el, .1, {rotation:0})
					       
					}
				}
				SucaiObj.prototype.fall = function(){
					if(this.isGrow || this.isFall){return};
					
					this.isFall = true;
//					TweenMax.killTweensOf(this.el);
//					TweenMax.killTweensOf(this.el2);
					var temp = [-1,1];
					var t = new TimelineMax({
//						delay:1,				
						onComplete:this.reGrow,
						onCompleteParams:[this]
					});
					t.to([this.el,this.el2],10,{
						y:height+200,
//						x:width,
//						rotation:randomInRange(30,180)*temp[Math.round(Math.random())],
//						ease:RoughEase.ease.config({ template:  Power0.easeNone, strength: 0.5, points: 10, taper: "out", randomize: false, clamp: false}),
//						overwrite:3
					})
					.to([this.el,this.el2],15,{
						x:randomInRange(10,20)*temp[Math.round(Math.random())],
						ease:Elastic.easeOut.config(3, 0.1)
					},"-=9.8")
					.to([this.el,this.el2],6,{
						rotation:randomInRange(60,180),
//						ease:Elastic.easeOut.config(3, 0.1)
					},"-=15")
//					.set([this.el,this.el2],{
//						x:0,
//						y:0,
//						scale:0,
//						rotation:0
//					},"+=15")
				}
				
				SucaiObj.prototype.reGrow = function(obj){
					obj.isFall = false;
					obj.grow(randomInRange(5,10),randomInRange(1,5),1,
					{
//							transform:'matrix(0,0,0,0,' + obj.x + ',' + obj.y + ')',
							x:0,
							y:0,
							rotation:0,
							scale:0
					}
					);
				}
			}
			
			function sucaiShake(e){
				var x = e.clientX * scaleX;
				var y = e.clientY * scaleY;
//				console.log(x,y)
				if(Math.random()>0.8){
					
					sucai1Arr.forEach(function(sucai){
//						if(Math.abs(x-sucai.x)<50 && Math.abs(y-sucai.y)<50){
//							console.log(Math.abs(x-sucai.x)+"__"+Math.abs(y-sucai.y))
								sucai.shake();
								
	//						console.log(TweenMax.isTweening(sucai))
//							if(Math.random()>0.99 && !sucai.isFall){
////								sucai.isFall = true;
//								sucai.fall();
//							}
//						}
					});
//				}
				
//					sucaiArr2.forEach(function(sucai){
//	//					if(Math.abs(x-sucai.x)<20 && Math.abs(y-sucai.y)<20){
//	//						console.log(Math.abs(x-sucai.x)+"__"+Math.abs(y-sucai.y))
//							sucai.shake(5,0);
//	//						console.log(TweenMax.isTweening(sucai))
//							if(Math.random()>0.9){
//								sucai.isFall = true;
//								sucai.fall(0.5);
//							}
//	//					}
//					});
//				
				}
				
			}
			
			let mouseEventDom = document.querySelector('.logo')
			mouseEventDom.addEventListener('mousemove',sucaiShake,false);

//			mouseEventDom.addEventListener('mouseup',mouseEvent,true);
			mouseEventDom.addEventListener('mousedown',mouseEvent,true);
			mouseEventDom.addEventListener('contextmenu',mouseEvent,true);
			function mouseEvent(e){
				e.preventDefault();
			}
			
			function randomInRange(min,max){
				return Math.round(Math.random()*(max-min+1))+min;
			}
			
//			function use(origin){
//				var useTag = document.createElementNS(SVG_NS,'use');
//				useTag.setAttributeNS(XLINK_NS,'xlink:href','#'+origin.id);
//				return useTag;
//			}
//			
//			function randerShape(shape,x,y,rotate){
//				var useShape = use(shape);
//				useShape.setAttribute('x',x);
//				useShape.setAttribute('y',y);
////				useShape.setAttribute('transform','translate(' + x +','+y +')');
//				tree_bg.appendChild(useShape);
//				return useShape;
//			}

			setInterval(function(){
				sucai1Arr.forEach(function(sucai){
//					console.log(TweenMax.isTweening(sucai))
					if(Math.random()>0.5 && !sucai.isShake && !sucai.isGrow && !sucai.isFall){
						sucai.shake();
//						if(Math.random()>0.85 && !sucai.isFall){
////							sucai.isFall = true;
//							sucai.fall();
//						}
					}
				});
				
				hdArr1.forEach(function(hd){
					if(Math.random()>0.5 && !TweenMax.isTweening(hd)){
						if(Math.random()>0.5 && !hd.isFall){
//							hd.isFall = true;
							hd.fall();
						}
					}
				})
			},10000)
		};
	</script>

</html>