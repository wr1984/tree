<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>Tree</title>
		<style type="text/css">
			html,
			body {
				margin: 0;
				padding: 0;
				line-height: 0;
				font-size: 0;
			}
			
			#tree-sucai {
				position: absolute;
				top: 0;
				left: 0;
			}
		</style>
	</head>

	<body>
		<!--<img src="img/Tree.png" />-->
		<!--<svg width="100%" height="100%" viewBox="0 0 1000 800" version="1.1" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin meet">-->

		<embed id="tree-bg" src="img/tree-bg-d.svg" width="100%" height="100%"></embed>
	</body>
	<script src="lib/TweenMax.min.js" type="text/javascript" charset="utf-8"></script>
	<script>
		window.onload = function() {
			var SVG_NS = "http://www.w3.org/2000/svg";
			var XLINK_NS = "http://www.w3.org/1999/xlink";
			var width = window.innerWidth;
			var height = window.innerHeight;
			var windowScale = width/height;
//			var svg = document.querySelector('svg');
			
			var embed = document.querySelector('#tree-bg');
			
			var svg_bg = embed.getSVGDocument().querySelector('#svg');

			var yz1 = svg_bg.getElementById('yz1');
			var yz2 = svg_bg.getElementById('yz2');
			var yz3 = svg_bg.getElementById('yz3');
			var yz4 = svg_bg.getElementById('yz4');
			var yz5 = svg_bg.getElementById('yz5');
			var sg1 = svg_bg.getElementById('sg1');
			var sg2 = svg_bg.getElementById('sg2');
			var sg3 = svg_bg.getElementById('sg3');
			var sg4 = svg_bg.getElementById('sg4');
			var bg = svg_bg.getElementById('bg');
			
			var sucai = [yz1,yz2,yz3,yz4,yz5,sg1,sg2,sg3,sg4];
			var tfOrigin = ["0% 80%","90% 90%","10% 90%","10% 90%","90% 10%","0% 100%","10% 100%","0% 100%","0% 100%"];
//			var t1 = new TimelineMax();
			//生长
			sucai.forEach(function(item,index){
				TweenMax.set(item,{
					transformOrigin:tfOrigin[index]
				});
				grow(item);
//				afterGrow(item);
			});
			
			
			function grow(element,time){
				TweenMax.from(element,randomInRange(5,20),{
					scale:0,
					ease: Linear.easeNone,
					delay:time || 2
				});

			}
			
			function afterGrow(element){
				TweenMax.from(element,10,{
					repeat:-1,
					yoyo:true,
					rotation:10,
					delay:8,
					ease: Back.easeInOut.config(2),
					repeatDelay:randomInRange(1,10)
				});
			}
			//抖动
//			TweenLite.to([yz1,yz3,yz4],2,{
//				ease:Elastic.easeOut.config(1, 0.2),
//				rotation:10,
//				delay:8
//			});
			
//			TweenMax.to([yz1,yz3],2,{
////				ease:Elastic.easeOut.config(1, 0.2),
//				repeat:-1,
//				yoyo:true,
//				rotation:10,
//				delay:8
//			});
			function shake(){
				sucai.forEach(function(item,index){
//					TweenMax.killTweensOf(item);
					if(!TweenMax.isTweening(item)){
						TweenMax.to(item,0.5,{
							ease:Elastic.easeIn.config(1, 0.2),
							rotation:20,
							repeat:1,
							yoyo:true,
//							delay:0.2
							onComplete:fall,
							onCompleteParams:[item]
						});
//						afterGrow(item);
					}
				})
			}
			
//			var t1 = new TimelineMax();
			function fall(item){
				if(Math.random()>0.2){
					TweenMax.to(item,5,{
						y:500,
						rotation:180,
						ease:Linear.easeOut,
						onComplete:grow,
						onConmpleteParams:[item,5]
					});
				}
			}
			
			svg_bg.addEventListener('mousedown',shake,false);
			
			function randomInRange(min,max){
				return Math.round(Math.random()*(max-min+1))+min;
			}
			
			function use(origin){
				var useTag = document.createElementNS(SVG_NS,'use');
				useTag.setAttributeNS(XLINK_NS,'xlink:href','#'+origin.id);
				return useTag;
			}
			
			function randerShape(shape,x,y,rotate){
				var useShape = use(shape);
				useShape.setAttribute('x',x);
				useShape.setAttribute('y',y);
//				useShape.setAttribute('transform','translate(' + x +','+y +')');
				tree_bg.appendChild(useShape);
				return useShape;
			}
		};
	</script>

</html>