<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>Tree</title>
		<style type="text/css">
			html,
			body {
				margin: 0;
				padding: 0;
				line-height: 0;
				font-size: 0;
			}
			
			#tree-sucai {
				position: absolute;
				top: 0;
				left: 0;
			}
			#svg{
				position: absolute;
				/*height: 100%;*/
				/*width: 1000px;
				height: 500px;*/
				/*background-image: url(img/tree-bg.png);*/
				/*background-size:auto 100%;
				background-repeat:no-repeat;*/
			}
			#box>.logo{
				position: absolute;
				width: 100%;
				height: 100%;
				z-index: 999;
				background-image: url(img/tree-logo.png);
				background-position: center;	
				background-size: 40% 40%;
				background-repeat: no-repeat;
			}
			#box{
				position: relative;
				overflow: hidden;
			}
			#bg{
				position: absolute;
				height: 100%;
				background-image: url(img/tree-3200x786.png);
				background-position: center;	
				background-size: 100% 100%;
				background-repeat: no-repeat;
			}
		</style>
	</head>

	<body>
		<!--<img src="img/Tree.png" />-->
		<!--<svg width="100%" height="100%" viewBox="0 0 1000 800" version="1.1" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin meet">-->
		<div id="box">
			<div id="bg"></div>
			<div id="svg" >
					<embed id="tree-bg" src="img/tree-bg-d.svg" width="100%" height="100%"></embed>
					<!--<embed id="tree-bg2" src="img/tree-bg-d.svg" width="50%" height="100%"></embed>-->
			</div>
			<div class="logo"></div>
		</div>
	</body>
	<script src="lib/TweenMax.min.js" type="text/javascript" charset="utf-8"></script>
	<script>
		window.onload = function() {
//			var me = this;
			var SVG_NS = "http://www.w3.org/2000/svg";
			var XLINK_NS = "http://www.w3.org/1999/xlink";
			var width = window.innerWidth;
			var height = window.innerHeight;
			var windowScale = width/height;
			var svgBox = document.querySelector('#box');
//			svgBox.style.overflow = 'hidden';
			svgBox.style.width = width + 'px';
			svgBox.style.height = height + 'px';
//			svgBox.style.width = '1600px';
//			svgBox.style.height = '700px';

			
			
			var embed = document.querySelector('#tree-bg');
//			var embed2 = document.querySelector('#tree-bg2');
			
			var svg_bg = embed.getSVGDocument().querySelector('#svg');
//			var svg_bg2 = embed2.getSVGDocument().querySelector('#svg');
			var svg_width = svg_bg.getAttribute('viewBox').split(" ")[2];
			var svg_height = svg_bg.getAttribute('viewBox').split(" ")[3];
			var scaleX = svg_width/width;
			var scaleY = svg_height/height;
			
			//跑马灯
//			svgBox.innerHTML += svgBox.innerHTML;
			let bg = document.getElementById('bg');
			let yzsvg = document.getElementById('svg');
			bg.style.width = width*2 + 'px';
			yzsvg.style.width  = width*2 + 'px';
			
			
			var yzOrigin = ["0% 80%","90% 90%","10% 90%","10% 90%","90% 10%","0% 100%","0% 100%","100% 100%","100% 100%","100% 100%"];
			var sgOrigin = ["0% 100%","10% 100%","0% 100%","0% 100%","0% 100%"];
			
			var yzArr = initSucai('yz', 10, yzOrigin,svg_bg);
			var sgArr = initSucai('sg', 5, sgOrigin,svg_bg);
			var sucaiArr = yzArr.concat(sgArr);
			
			var left = null;
			setInterval(function(){
				left -= 0.1;
				if(left < -bg.offsetWidth/2){
					left=0;
				}
				yzsvg.style.left = left + 'px';
				bg.style.left = left + 'px';
				
				var l = Math.abs(Math.floor(left));
				sucaiArr.forEach(function(sucai){
					var x = Math.floor(sucai.x);
					if(l === x){
//						TweenMax.set(sucai.el,{
//							transform:'matrix(0,0,0,0,' + sucai.x + width + ',' + obj.y + ')',
//						})
					}
				});
				
				
			},60/1000);
			console.log(sucaiArr[0].el);
//			console.log(sucaiArr[1].el);
			
			
			yzArr.forEach(function(yz){
				yz.init();
				yz.grow(randomInRange(5,20),randomInRange(1,5));
			});
			sgArr.forEach(function(sg){
				sg.init();
				sg.grow(randomInRange(5,10),randomInRange(1,5));
			});
			
			
			
			
//			var yzArr2 = initSucai('yz', 10, yzOrigin,svg_bg2);
//			var sgArr2 = initSucai('sg', 5, sgOrigin,svg_bg2);
//			var sucaiArr2 = yzArr2.concat(sgArr2);
//			
//			yzArr2.forEach(function(yz){
//				yz.init();
//				yz.grow(randomInRange(5,20),randomInRange(1,5));
//			});
//			sgArr2.forEach(function(sg){
//				sg.init();
//				sg.grow(randomInRange(5,10),randomInRange(1,5));
//			});
			
			
			
			
			
			function initSucai(name,count,origin,svg){
				var arr = [];
				for(var i = 0; i<count; i++){
					arr.push(new SucaiObj(name,i+1,origin,svg));
				}
				return arr;
			}
			
			function SucaiObj(name,index,origin,svg){
				
				this.id = name+index;
				this.name = name;
				this.el = svg.getElementById(this.id); 
				this.x;
				this.y;
				this.opacity = 0.8;
				this.scale = 0;
				this.transformOrigin = origin[index-1];
				this.isFall = false;
			
				SucaiObj.prototype.init = function(){
					TweenMax.set(this.el,{
						opacity: this.opacity,
						scale: this.scale,
						transformOrigin: this.transformOrigin
					});
					this.x = this.el.getAttribute('data-svg-origin').split(" ")[0];
					this.y = this.el.getAttribute('data-svg-origin').split(" ")[1];
				}
				SucaiObj.prototype.grow = function(growTime,delayTime,scale,startAt){
					
						TweenMax.to(this.el,growTime || 10,{
							scale: scale || 1,
							ease:Linear.easeNone,
							delay:delayTime || 2,
							startAt:startAt
						});
						
//						console.log(yz1)
				}
				SucaiObj.prototype.shake = function(s,t){
					if(!this.isFall){
//					  TweenMax.killTweensOf(this.el);
					  new TimelineMax()
					  .to(this.el, 10, {rotation:5, ease:Elastic.easeOut.config(3, 0.1)})
//					  .to(this.el, 1, {rotation:0})
					       
					}
				}
				SucaiObj.prototype.fall = function(t){
//					TweenMax.killTweensOf(this.el);
					var temp = [-1,1];
					var t = new TimelineMax({
						delay:t||2,				
						onComplete:this.reGrow,
						onCompleteParams:[this]
					});
					t.to(this.el,10,{
						y:height,
//						x:width,
//						rotation:randomInRange(30,180)*temp[Math.round(Math.random())],
//						ease:RoughEase.ease.config({ template:  Power0.easeNone, strength: 0.5, points: 10, taper: "out", randomize: false, clamp: false}),
						overwrite:3
					})
					.to(this.el,20,{
						x:randomInRange(5,20)*temp[Math.round(Math.random())],
						ease:Elastic.easeOut.config(3, 0.1)
					},"-=9.8")
					.to(this.el,6,{
						rotation:randomInRange(60,180),
//						ease:Elastic.easeOut.config(3, 0.1)
					},"-=20")
				}
				
				SucaiObj.prototype.reGrow = function(obj){
					obj.isFall = false
					obj.grow(randomInRange(5,10),randomInRange(1,5),1, {
							transform:'matrix(0,0,0,0,' + obj.x + ',' + obj.y + ')',
							scale:0
					});
				}
			}
			
			function sucaiShake(e){
				var x = e.clientX * scaleX;
				var y = e.clientY * scaleY;
//				console.log(x,y)
				if(Math.random()>0.991){
					
					sucaiArr.forEach(function(sucai){
	//					if(Math.abs(x-sucai.x)<20 && Math.abs(y-sucai.y)<20){
	//						console.log(Math.abs(x-sucai.x)+"__"+Math.abs(y-sucai.y))
							sucai.shake(5,0);
	//						console.log(TweenMax.isTweening(sucai))
							if(Math.random()>0.99){
								sucai.isFall = true;
								sucai.fall(0.5);
							}
	//					}
					});
//				}
				
//					sucaiArr2.forEach(function(sucai){
//	//					if(Math.abs(x-sucai.x)<20 && Math.abs(y-sucai.y)<20){
//	//						console.log(Math.abs(x-sucai.x)+"__"+Math.abs(y-sucai.y))
//							sucai.shake(5,0);
//	//						console.log(TweenMax.isTweening(sucai))
//							if(Math.random()>0.9){
//								sucai.isFall = true;
//								sucai.fall(0.5);
//							}
//	//					}
//					});
//				
				}
				
			}
			
			let mouseEventDom = document.querySelector('.logo')
			mouseEventDom.addEventListener('mousemove',sucaiShake,false);
//			
			function randomInRange(min,max){
				return Math.round(Math.random()*(max-min+1))+min;
			}
			
//			function use(origin){
//				var useTag = document.createElementNS(SVG_NS,'use');
//				useTag.setAttributeNS(XLINK_NS,'xlink:href','#'+origin.id);
//				return useTag;
//			}
//			
//			function randerShape(shape,x,y,rotate){
//				var useShape = use(shape);
//				useShape.setAttribute('x',x);
//				useShape.setAttribute('y',y);
////				useShape.setAttribute('transform','translate(' + x +','+y +')');
//				tree_bg.appendChild(useShape);
//				return useShape;
//			}

			setInterval(function(){
				sucaiArr.forEach(function(sucai){
//					console.log(TweenMax.isTweening(sucai))
					if(Math.random()>0.5 && !TweenMax.isTweening(sucai)){
						sucai.shake(-5,0.5);
						if(Math.random()>0.85){
							sucai.isFall = true;
							sucai.fall(2);
						}
					}
				});
			},10000)
		};
	</script>

</html>